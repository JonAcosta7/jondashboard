<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Spreads Trading Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .metrics-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .positive { color: #38a169; }
        .negative { color: #e53e3e; }

        .form-section {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #4a5568;
        }

        input, select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .trade-list {
            max-height: 300px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .trade-item {
            padding: 15px;
            border-bottom: 1px solid #f7fafc;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            align-items: center;
            transition: background-color 0.3s ease;
        }

        .trade-item:hover {
            background-color: #f7fafc;
        }

        .status-open { background-color: #fef5e7; }
        .status-closed { background-color: #f0fff4; }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .risk-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .risk-low { background-color: #c6f6d5; color: #22543d; }
        .risk-medium { background-color: #feebc8; color: #c05621; }
        .risk-high { background-color: #fed7d7; color: #c53030; }

        .insights-panel {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #2d3748, #4a5568);
            color: white;
        }

        .insight-item {
            padding: 15px;
            margin: 10px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Credit Spreads Trading Dashboard</h1>
            <p>Building $3k to $100k - Track Performance & Make Better Decisions</p>
        </div>

        <div class="dashboard-grid">
            <!-- Account Overview -->
            <div class="card">
                <h3>Account Overview</h3>
                <div class="metrics-row">
                    <div class="metric">
                        <div class="metric-value" id="accountValue">$3,000</div>
                        <div class="metric-label">Account Value</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value positive" id="totalReturn">+0%</div>
                        <div class="metric-label">Total Return</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="monthlyReturn">+0%</div>
                        <div class="metric-label">Monthly Return</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="winRate">0%</div>
                        <div class="metric-label">Win Rate</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="accountChart"></canvas>
                </div>
            </div>

            <!-- Position Management -->
            <div class="card">
                <h3>Active Positions</h3>
                <div class="metrics-row">
                    <div class="metric">
                        <div class="metric-value" id="activePositions">0</div>
                        <div class="metric-label">Active Trades</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="capitalAtRisk">$0</div>
                        <div class="metric-label">Capital at Risk</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="maxLoss">$0</div>
                        <div class="metric-label">Max Potential Loss</div>
                    </div>
                </div>

                <div id="riskLevel" class="risk-indicator risk-low">Low Risk</div>
                
                <div class="chart-container">
                    <canvas id="riskChart"></canvas>
                </div>
            </div>

            <!-- Trade Entry -->
            <div class="card">
                <h3>New Trade Entry</h3>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('bullPut')">Bull Put Spread</div>
                    <div class="tab" onclick="switchTab('bearCall')">Bear Call Spread</div>
                </div>

                <div id="bullPut" class="tab-content active">
                    <div class="form-section">
                        <div class="form-row">
                            <div class="input-group">
                                <label>Underlying</label>
                                <select id="underlying1">
                                    <option value="SPY">SPY</option>
                                    <option value="QQQ">QQQ</option>
                                    <option value="IWM">IWM</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Current Price</label>
                                <input type="number" id="currentPrice1" placeholder="570" step="0.01">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="input-group">
                                <label>Short Strike (Sell Put)</label>
                                <input type="number" id="shortStrike1" placeholder="565" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Long Strike (Buy Put)</label>
                                <input type="number" id="longStrike1" placeholder="560" step="0.01">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="input-group">
                                <label>Credit Received</label>
                                <input type="number" id="creditReceived1" placeholder="80" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Days to Expiration</label>
                                <input type="number" id="dte1" placeholder="30">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="bearCall" class="tab-content">
                    <div class="form-section">
                        <div class="form-row">
                            <div class="input-group">
                                <label>Underlying</label>
                                <select id="underlying2">
                                    <option value="SPY">SPY</option>
                                    <option value="QQQ">QQQ</option>
                                    <option value="IWM">IWM</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Current Price</label>
                                <input type="number" id="currentPrice2" placeholder="480" step="0.01">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="input-group">
                                <label>Short Strike (Sell Call)</label>
                                <input type="number" id="shortStrike2" placeholder="485" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Long Strike (Buy Call)</label>
                                <input type="number" id="longStrike2" placeholder="490" step="0.01">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="input-group">
                                <label>Credit Received</label>
                                <input type="number" id="creditReceived2" placeholder="75" step="0.01">
                            </div>
                            <div class="input-group">
                                <label>Days to Expiration</label>
                                <input type="number" id="dte2" placeholder="30">
                            </div>
                        </div>
                    </div>
                </div>

                <button onclick="analyzeTrade()">Analyze Trade</button>
                <button onclick="addTrade()">Add Trade</button>
                
                <div id="tradeAnalysis" style="margin-top: 20px; display: none;">
                    <h4>Trade Analysis</h4>
                    <div class="metrics-row">
                        <div class="metric">
                            <div class="metric-value" id="maxProfit">$0</div>
                            <div class="metric-label">Max Profit</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="maxRisk">$0</div>
                            <div class="metric-label">Max Risk</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="returnPercent">0%</div>
                            <div class="metric-label">Return %</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="breakeven">$0</div>
                            <div class="metric-label">Breakeven</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Analytics -->
            <div class="card">
                <h3>Performance Analytics</h3>
                <div class="metrics-row">
                    <div class="metric">
                        <div class="metric-value" id="avgReturn">0%</div>
                        <div class="metric-label">Avg Return/Trade</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="bestTrade">$0</div>
                        <div class="metric-label">Best Trade</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="worstTrade">$0</div>
                        <div class="metric-label">Worst Trade</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="sharpeRatio">0.0</div>
                        <div class="metric-label">Sharpe Ratio</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <!-- Trade History -->
            <div class="card">
                <h3>Trade History</h3>
                <div class="trade-list" id="tradeHistory">
                    <div style="padding: 20px; text-align: center; color: #718096;">
                        No trades yet. Add your first trade to get started!
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="card">
                <h3>Data Management</h3>
                <div class="form-row">
                    <button onclick="exportData()">üì• Export Data</button>
                    <div>
                        <input type="file" id="importFile" accept=".json" onchange="importData(event)" style="display: none;">
                        <button onclick="document.getElementById('importFile').click()">üì§ Import Data</button>
                    </div>
                    <button onclick="clearAllData()" style="background: linear-gradient(135deg, #e53e3e, #c53030);">üóëÔ∏è Clear All Data</button>
                </div>
                <div style="margin-top: 15px; padding: 15px; background: #f7fafc; border-radius: 8px; font-size: 0.9rem; color: #4a5568;">
                    <strong>üìä Data Status:</strong> Your trades are automatically saved in your browser and will persist between sessions. Use export/import for backups or transferring between devices.
                </div>
            </div>

            <!-- AI Insights & Recommendations -->
            <div class="card insights-panel">
                <h3>AI Insights & Recommendations</h3>
                <div id="insights">
                    <div class="insight-item">
                        <strong>üìä Portfolio Health:</strong> Your account is ready for the first trade. Consider starting with a bull put spread on SPY with 30-45 days to expiration.
                    </div>
                    <div class="insight-item">
                        <strong>üéØ Risk Management:</strong> Remember to limit each trade to 15% of your account value. With $3,000, maximum risk per trade should be $450.
                    </div>
                    <div class="insight-item">
                        <strong>üìà Strategy Focus:</strong> For account building phase, focus on high-probability trades with 70%+ win rate rather than chasing maximum returns.
                    </div>
                    <div class="insight-item">
                        <strong>‚è∞ Timing:</strong> Best to open new positions on Mondays and Tuesdays for optimal time decay. Avoid trading day before major economic announcements.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global data storage with persistence
        let accountData = loadData() || {
            balance: 3000,
            startingBalance: 3000,
            trades: [],
            accountHistory: [3000]
        };

        let activeTab = 'bullPut';

        // Data persistence functions
        function saveData() {
            try {
                const dataToSave = JSON.stringify(accountData);
                localStorage.setItem('creditSpreadsData', dataToSave);
                console.log('Data saved successfully');
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('creditSpreadsData');
                if (savedData) {
                    return JSON.parse(savedData);
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
            return null;
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all trade data? This cannot be undone.')) {
                localStorage.removeItem('creditSpreadsData');
                accountData = {
                    balance: 3000,
                    startingBalance: 3000,
                    trades: [],
                    accountHistory: [3000]
                };
                updateDisplays();
                alert('All data cleared successfully');
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(accountData, null, 2);
            const dataBlob = new Blob([dataStr], {type:'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `credit-spreads-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (confirm('This will replace all current data. Continue?')) {
                            accountData = importedData;
                            saveData();
                            updateDisplays();
                            alert('Data imported successfully');
                        }
                    } catch (error) {
                        alert('Error importing data: Invalid file format');
                    }
                };
                reader.readAsText(file);
            }
        }

        // Initialize charts
        let accountChart, riskChart, performanceChart;

        function initializeCharts() {
            // Account Growth Chart
            const accountCtx = document.getElementById('accountChart').getContext('2d');
            accountChart = new Chart(accountCtx, {
                type: 'line',
                data: {
                    labels: ['Start'],
                    datasets: [{
                        label: 'Account Value',
                        data: [3000],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Risk Distribution Chart
            const riskCtx = document.getElementById('riskChart').getContext('2d');
            riskChart = new Chart(riskCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Available Capital', 'Capital at Risk'],
                    datasets: [{
                        data: [3000, 0],
                        backgroundColor: ['#38a169', '#e53e3e'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Performance Chart
            const perfCtx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(perfCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Trade P&L',
                        data: [],
                        backgroundColor: [],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
        }

        function switchTab(tabName) {
            activeTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
        }

        function analyzeTrade() {
            const isActive = activeTab === 'bullPut';
            const suffix = isActive ? '1' : '2';
            
            const currentPrice = parseFloat(document.getElementById(`currentPrice${suffix}`).value);
            const shortStrike = parseFloat(document.getElementById(`shortStrike${suffix}`).value);
            const longStrike = parseFloat(document.getElementById(`longStrike${suffix}`).value);
            const credit = parseFloat(document.getElementById(`creditReceived${suffix}`).value);
            
            if (isNaN(currentPrice) || isNaN(shortStrike) || isNaN(longStrike) || isNaN(credit)) {
                alert('Please fill in all trade parameters');
                return;
            }
            
            const strikeWidth = Math.abs(shortStrike - longStrike) * 100;
            const maxProfit = credit;
            const maxRisk = strikeWidth - credit;
            const returnPercent = (maxProfit / maxRisk * 100).toFixed(1);
            
            let breakeven;
            if (isActive) { // Bull Put Spread
                breakeven = shortStrike - (credit / 100);
            } else { // Bear Call Spread
                breakeven = shortStrike + (credit / 100);
            }
            
            document.getElementById('maxProfit').textContent = `$${maxProfit}`;
            document.getElementById('maxRisk').textContent = `$${maxRisk}`;
            document.getElementById('returnPercent').textContent = `${returnPercent}%`;
            document.getElementById('breakeven').textContent = `$${breakeven.toFixed(2)}`;
            
            document.getElementById('tradeAnalysis').style.display = 'block';
            
            // Update insights
            updateInsights(maxRisk, returnPercent, currentPrice, shortStrike, isActive);
        }

        function addTrade() {
            const isActive = activeTab === 'bullPut';
            const suffix = isActive ? '1' : '2';
            
            const underlying = document.getElementById(`underlying${suffix}`).value;
            const currentPrice = parseFloat(document.getElementById(`currentPrice${suffix}`).value);
            const shortStrike = parseFloat(document.getElementById(`shortStrike${suffix}`).value);
            const longStrike = parseFloat(document.getElementById(`longStrike${suffix}`).value);
            const credit = parseFloat(document.getElementById(`creditReceived${suffix}`).value);
            const dte = parseInt(document.getElementById(`dte${suffix}`).value);
            
            if (isNaN(currentPrice) || isNaN(shortStrike) || isNaN(longStrike) || isNaN(credit) || isNaN(dte)) {
                alert('Please fill in all trade parameters and analyze first');
                return;
            }
            
            const strikeWidth = Math.abs(shortStrike - longStrike) * 100;
            const maxRisk = strikeWidth - credit;
            
            // Risk management check
            if (maxRisk > accountData.balance * 0.15) {
                alert(`Trade risk ($${maxRisk}) exceeds 15% of account. Maximum allowed: $${(accountData.balance * 0.15).toFixed(0)}`);
                return;
            }
            
            const trade = {
                id: Date.now(),
                type: isActive ? 'Bull Put Spread' : 'Bear Call Spread',
                underlying: underlying,
                openDate: new Date().toLocaleDateString(),
                currentPrice: currentPrice,
                shortStrike: shortStrike,
                longStrike: longStrike,
                credit: credit,
                maxRisk: maxRisk,
                dte: dte,
                status: 'Open',
                pnl: 0,
                closeDate: null
            };
            
            accountData.trades.push(trade);
            saveData(); // Save after adding trade
            updateDisplays();
            clearForm();
            alert('Trade added successfully!');
        }

        function closeTrade(tradeId, pnl) {
            const trade = accountData.trades.find(t => t.id === tradeId);
            if (trade) {
                trade.status = 'Closed';
                trade.pnl = pnl;
                trade.closeDate = new Date().toLocaleDateString();
                accountData.balance += pnl;
                accountData.accountHistory.push(accountData.balance);
                saveData(); // Save after closing trade
                updateDisplays();
            }
        }

        function updateDisplays() {
            // Account metrics
            const totalReturn = ((accountData.balance - accountData.startingBalance) / accountData.startingBalance * 100).toFixed(1);
            const openTrades = accountData.trades.filter(t => t.status === 'Open');
            const closedTrades = accountData.trades.filter(t => t.status === 'Closed');
            const winRate = closedTrades.length > 0 ? (closedTrades.filter(t => t.pnl > 0).length / closedTrades.length * 100).toFixed(1) : '0';
            
            document.getElementById('accountValue').textContent = `${accountData.balance.toLocaleString()}`;
            document.getElementById('totalReturn').textContent = `+${totalReturn}%`;
            document.getElementById('totalReturn').className = totalReturn >= 0 ? 'metric-value positive' : 'metric-value negative';
            document.getElementById('winRate').textContent = `${winRate}%`;
            
            // Risk metrics
            const capitalAtRisk = openTrades.reduce((sum, trade) => sum + trade.maxRisk, 0);
            document.getElementById('activePositions').textContent = openTrades.length;
            document.getElementById('capitalAtRisk').textContent = `${capitalAtRisk}`;
            document.getElementById('maxLoss').textContent = `${capitalAtRisk}`;
            
            // Risk level
            const riskPercent = capitalAtRisk / accountData.balance;
            let riskLevel = 'Low Risk';
            let riskClass = 'risk-low';
            if (riskPercent > 0.4) {
                riskLevel = 'High Risk';
                riskClass = 'risk-high';
            } else if (riskPercent > 0.2) {
                riskLevel = 'Medium Risk';
                riskClass = 'risk-medium';
            }
            
            const riskElement = document.getElementById('riskLevel');
            riskElement.textContent = riskLevel;
            riskElement.className = `risk-indicator ${riskClass}`;
            
            // Performance metrics
            if (closedTrades.length > 0) {
                const avgReturn = (closedTrades.reduce((sum, trade) => sum + (trade.pnl / trade.maxRisk * 100), 0) / closedTrades.length).toFixed(1);
                const bestTrade = Math.max(...closedTrades.map(t => t.pnl));
                const worstTrade = Math.min(...closedTrades.map(t => t.pnl));
                
                document.getElementById('avgReturn').textContent = `${avgReturn}%`;
                document.getElementById('bestTrade').textContent = `${bestTrade}`;
                document.getElementById('worstTrade').textContent = `${worstTrade}`;
            }
            
            // Update charts
            updateCharts();
            updateTradeHistory();
        }

        function updateCharts() {
            // Account chart
            const labels = accountData.accountHistory.map((_, i) => i === 0 ? 'Start' : `Trade ${i}`);
            accountChart.data.labels = labels;
            accountChart.data.datasets[0].data = accountData.accountHistory;
            accountChart.update();
            
            // Risk chart
            const openTrades = accountData.trades.filter(t => t.status === 'Open');
            const capitalAtRisk = openTrades.reduce((sum, trade) => sum + trade.maxRisk, 0);
            riskChart.data.datasets[0].data = [accountData.balance - capitalAtRisk, capitalAtRisk];
            riskChart.update();
            
            // Performance chart
            const closedTrades = accountData.trades.filter(t => t.status === 'Closed');
            if (closedTrades.length > 0) {
                performanceChart.data.labels = closedTrades.map((_, i) => `Trade ${i + 1}`);
                performanceChart.data.datasets[0].data = closedTrades.map(t => t.pnl);
                performanceChart.data.datasets[0].backgroundColor = closedTrades.map(t => t.pnl >= 0 ? '#38a169' : '#e53e3e');
                performanceChart.update();
            }
        }

        function updateTradeHistory() {
            const historyContainer = document.getElementById('tradeHistory');
            
            if (accountData.trades.length === 0) {
                historyContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #718096;">No trades yet. Add your first trade to get started!</div>';
                return;
            }
            
            const tradesHtml = accountData.trades.map(trade => `
                <div class="trade-item status-${trade.status.toLowerCase()}">
                    <div><strong>${trade.type}</strong></div>
                    <div>${trade.underlying}</div>
                    <div>${trade.shortStrike}/${trade.longStrike}</div>
                    <div>${trade.credit}</div>
                    <div class="${trade.pnl >= 0 ? 'positive' : 'negative'}">${trade.status === 'Closed' ? `${trade.pnl}` : 'Open'}</div>
                    <div>${trade.status === 'Open' ? 
                        `<button onclick="closeTrade(${trade.id}, parseFloat(prompt('Enter P&L:')) || 0)" style="padding: 5px 10px; font-size: 0.8rem;">Close</button>` : 
                        trade.closeDate}</div>
                </div>
            `).join('');
            
            historyContainer.innerHTML = tradesHtml;
        }

        function updateInsights(maxRisk, returnPercent, currentPrice, shortStrike, isBullPut) {
            const insightsContainer = document.getElementById('insights');
            const riskPercentOfAccount = (maxRisk / accountData.balance * 100).toFixed(1);
            const distance = isBullPut ? ((currentPrice - shortStrike) / currentPrice * 100).toFixed(1) : ((shortStrike - currentPrice) / currentPrice * 100).toFixed(1);
            
            let insights = [];
            
            // Risk management insight
            if (maxRisk > accountData.balance * 0.15) {
                insights.push(`<div class="insight-item"><strong>‚ö†Ô∏è Risk Warning:</strong> This trade risks ${riskPercentOfAccount}% of your account. Consider reducing position size to stay under 15% limit.</div>`);
            } else {
                insights.push(`<div class="insight-item"><strong>‚úÖ Risk Check:</strong> Trade risk (${riskPercentOfAccount}%) is within safe limits. Good position sizing!</div>`);
            }
            
            // Return analysis
            if (returnPercent > 25) {
                insights.push(`<div class="insight-item"><strong>üìà High Return:</strong> ${returnPercent}% return is attractive but may indicate higher risk. Verify strike selection.</div>`);
            } else if (returnPercent < 15) {
                insights.push(`<div class="insight-item"><strong>üìä Conservative:</strong> ${returnPercent}% return is conservative. Consider if risk/reward meets your targets.</div>`);
            } else {
                insights.push(`<div class="insight-item"><strong>üéØ Good Target:</strong> ${returnPercent}% return fits the 15-25% sweet spot for credit spreads.</div>`);
            }
            
            // Probability insight
            if (distance > 5) {
                insights.push(`<div class="insight-item"><strong>üõ°Ô∏è Safe Distance:</strong> ${distance}% out-of-money provides good cushion. High probability trade.</div>`);
            } else if (distance < 2) {
                insights.push(`<div class="insight-item"><strong>‚ö° Close to Strike:</strong> Only ${distance}% away from short strike. Higher risk but better premium.</div>`);
            } else {
                insights.push(`<div class="insight-item"><strong>‚öñÔ∏è Balanced:</strong> ${distance}% distance offers good balance of premium and safety.</div>`);
            }
            
            // Account building insight
            const openTrades = accountData.trades.filter(t => t.status === 'Open').length;
            if (openTrades >= 3) {
                insights.push(`<div class="insight-item"><strong>üìä Portfolio:</strong> You have ${openTrades} open positions. Consider concentration risk and correlation.</div>`);
            } else {
                insights.push(`<div class="insight-item"><strong>üìà Scaling:</strong> Room for ${3 - openTrades} more positions to optimize capital usage while managing risk.</div>`);
            }
            
            insightsContainer.innerHTML = insights.join('');
        }

        function clearForm() {
            // Clear bull put form
            document.getElementById('currentPrice1').value = '';
            document.getElementById('shortStrike1').value = '';
            document.getElementById('longStrike1').value = '';
            document.getElementById('creditReceived1').value = '';
            document.getElementById('dte1').value = '';
            
            // Clear bear call form
            document.getElementById('currentPrice2').value = '';
            document.getElementById('shortStrike2').value = '';
            document.getElementById('longStrike2').value = '';
            document.getElementById('creditReceived2').value = '';
            document.getElementById('dte2').value = '';
            
            // Hide analysis
            document.getElementById('tradeAnalysis').style.display = 'none';
        }

        // Initialize on page load
        window.onload = function() {
            initializeCharts();
            updateDisplays(); // This will load saved data
        };
    </script>
</body>
</html>